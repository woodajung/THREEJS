<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>glow animation</title>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body { 
                padding:0;
                margin:0;
                overflow:hidden;
				/*background-color: #000;*/
             }
            canvas { width: 100%; height: 100% }

            /* object loader progressbar */
			.ui-progressbar { display: none; width: 150px; height: 15px; position: absolute; left: 50%; top: 50%; margin-left: -75px; margin-top: -7px; }
			.progress-label { position: absolute; left: 50%; top: 1px; font-size: 12px; font-weight: bold; text-shadow: 1px 1px 0 #fff; margin-left:-10px; }
			.ui-widget-header { border: 1px solid lightgray; background: url("/js/jquery.ui/images/ui-bg_highlight-soft_75_cccccc_1x100.png") 50% 50% repeat-x; font-weight: bold; margin-left:-10px; }
        </style>
    </head>
    <body>
        <div id="progressbar">
            <div id="progress-label"></div>
        </div>
        <script type="text/javascript" src="./jquery-3.4.1/jquery.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="./jquery-ui.1.12.1/jquery-ui.min.js"></script>
        <script type="text/javascript" src="./three-0.106.2/three.min.js" charset="utf-8"></script>
        <script type="text/javascript" src="./three-0.106.2/libs/Tween.js"></script>
        <script type="text/javascript" src="./three-0.106.2/controls/TrackballControls.js"></script>
        <script type="text/javascript" src="./three-0.106.2/loaders/MTLLoader.js"></script>
        <script type="text/javascript" src="./three-0.106.2/loaders/OBJLoader.js"></script>
        <script type="text/javascript">
            var scene, renderer, camera, controls;
            init();

            function init() {
                renderer = new THREE.WebGLRenderer({alpha: true, antialias: true});
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.autoClear = false;
                
                //renderer.shadowMap.enabled = true;                    //그림자 효과 추가
                //renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                //renderer.gammaInput = true;                           //material 광택 효과 추가
                //renderer.gammaOutput = true;

                document.body.appendChild( renderer.domElement );
                
                scene = new THREE.Scene();

                camera = new THREE.PerspectiveCamera( 
                    45,                                         //FOV
                    window.innerWidth / window.innerHeight,     //aspect
                    1,                                          //near clipping plane
                    10000                                       //far clipping plane
                );
                camera.position.set( 0, 200, 800 );
                camera.lookAt(scene.position);

                controls = new THREE.TrackballControls(camera, renderer.domElement);
                //controls.rotateSpeed = 1.0;
                //controls.zoomSpeed = 1.2;
                //controls.panSpeed = 0.8;
                controls.enabled = true;
                //controls.dynamicDampingFactor = 0.3;
                //controls.keys = [ 65, 83, 68 ];

                // set up ambient light
                var ambientLight = new THREE.AmbientLight(new THREE.Color('#ffffff'), 1);
                scene.add(ambientLight);

                var light = new THREE.PointLight(0xffffff);
                //light.shadow.camera.left = -window.innerWidth / 2;
                //light.shadow.camera.right = window.innerWidth / 2;
                //light.shadow.camera.top = -window.innerHeight / 2;
                //light.shadow.camera.bottom = window.innerHeight / 2;
                //light.shadow.camera.far = 2500;
                //light.shadow.mapSize.Width = 2048;
                //light.shadow.mapSize.Height = 2048;
                //light.castShadow = true;
                light.position.set(100, 250, 250);
                scene.add(light);
                var lightHelper = new THREE.PointLightHelper(light);
                scene.add(lightHelper);

                //바닥 추가
                var planeGeometry = new THREE.PlaneGeometry( 5, 20, 32 );
                var planeMaterial = new THREE.MeshBasicMaterial( {color: 0xffff00, side: THREE.DoubleSide} );
                var plane = new THREE.Mesh(planeGeometry, planeMaterial);
                plane.rotation.x = -Math.PI / 2;
                plane.receiveShadow = true;
                scene.add(plane);
                
                //loading manager 추가
                var $progressbar = $('#progressbar');
				var manager = new THREE.LoadingManager();
			    manager.onStart = function (url, itemsLoaded, itemsTotal) {
				    console.debug('3D Component Object, Loading Start!');
					$progressbar.progressbar({
						value: false,
						change: function() {
							$progressbar.children('.progress-label').text( $progressbar.progressbar( "value" ) + "%" );
						}
                    });
                    $progressbar.css('display', 'block');
			    };
			    manager.onProgress = function ( url, itemsLoaded, itemsTotal ) {
				    var val = itemsLoaded / itemsTotal * 100;
				    $progressbar.progressbar('value', Math.floor(val));
			    };
				manager.onError = function(url) {
					console.error('There was an error loading: ' + url);
				};
				manager.onLoad = function () {
					$progressbar.css('display', 'none');
                };
                //obj 로드
                var mtlLoader = new THREE.MTLLoader(manager);
                //mtlLoader.setPath('./three-0.106.2/models/');
                mtlLoader.setPath('http://localhost:9400/dashboard/resources/3d/ea/');
                mtlLoader.load('server.mtl', function(materials) {
                    materials.preload();
                    var objLoader = new THREE.OBJLoader(manager);
                    //objLoader.setPath('./three-0.106.2/models/');
                    objLoader.setPath('http://localhost:9400/dashboard/resources/3d/ea/');
                    objLoader.setMaterials(materials);
                    objLoader.load('server.obj', function(obj) {
                        obj.traverse(function (child) {
                            if (child instanceof THREE.Mesh) {
                                 //child.material.color = new THREE.Color('#ffffff');
                                child.castShadow = true;
                                child.receiveShadow = true;
                                child.material.needsUpdate = true;
                                if (child.name === 'glow') {
                                    //addGlowObject();
                                }
                            }
                        });
                        obj.name = 'server';
                        //obj.position.copy(jsonInfo.position);
                        //obj.rotation.x += THREE.Math.degToRad(jsonInfo.rotation.x);
                        //obj.rotation.y += THREE.Math.degToRad(jsonInfo.rotation.y);
                        //obj.rotation.z += THREE.Math.degToRad(jsonInfo.rotation.z);
                        scene.add(obj);
                    });
                });
                
                window.addEventListener( 'resize', function () {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize( window.innerWidth, window.innerHeight );
                }, false );

                animate();
            }

            function animate () {
                requestAnimationFrame( animate );
                controls.update();
                renderer.render( scene, camera );
                
                //cube.rotation.x += 0.01;
            }
        </script>
    </body>
</html>